# P8 纠正说明（品牌 SOV 与趋势）

本页包含 7 个图表，主旨为“品牌声量份额（SOV） + 趋势对比”。以下针对理解、指标与计算口径做集中纠正与细化。

## 1. 图表理解纠正
- 总体主题应为“品牌声量占比 + Lenovo vs Others 趋势”。若页面中存在环形/饼图、堆叠柱状图与折线图组合，均围绕上述两类洞察展开。
- “Others”口径需严格定义为“所选品牌集合总声量 − Lenovo 声量”，且集合需保持一致（不可动态变化导致 Others 不可比）。
- 若存在多国家或多渠道，请确保页面指定的筛选条件（国家、渠道、时间范围）与数据聚合口径一致，避免口径漂移。
- 趋势图如显示波峰/波谷，应核对是否由活动投放、节假日或异常数据造成；必要时在图例或注释中标记关键事件。

## 2. 是否需要新增指标（建议）
- SOV by Channel：按渠道（社媒/新闻/论坛/视频等）拆分 SOV，可定位渠道结构差异。
- 加权 SOV（Weighted SOV）：按触达/曝光或互动权重（如 impressions、engagement）进行加权，更贴近影响力而非仅提及量。
- SoE（Share of Engagement）/ SoV-of-Voice-Positive：引入互动占比与正向声量占比，用于补充质量维度。
- 正负向净声量（Net Sentiment Volume）：正向 − 负向；可作为趋势子图或数据标签。
- 正规化指数（Index=Brand/Benchmark×100）：用于多国家或多渠道横向比较的可比性度量。

## 3. 指标计算方法（公式）
- 品牌声量份额（SOV）
  - SOV(brand, t) = brand_mentions(brand, t) / total_mentions(t) × 100
  - Others 声量份额：SOV(others, t) = (total_mentions(t) − brand_mentions(Lenovo, t)) / total_mentions(t) × 100
- 趋势（Lenovo vs Others）
  - 构造同一时间粒度（日/周/月）的时间序列并对齐缺失日期；必要时做 7D 滑动均值以平滑噪声。
- SoE（互动占比）
  - SoE(brand, t) = brand_engagements(brand, t) / total_engagements(t) × 100
- 加权 SOV（示例）
  - Weighted_SOV(brand, t) = Σ_channel [ w_channel × mentions(brand, channel, t) ] / Σ_channel [ w_channel × mentions(all, channel, t) ] × 100
  - w_channel 可由历史触达/互动均值、业务设定或回归拟合获得。

## 4. 数据计算方法与口径
- 粒度与对齐：
  - 趋势采用“日级”；SOV 展示推荐使用“月度/周度”或“最近 N 天汇总”，与页面时间范围保持一致。
  - 若日级缺失，需显式填充 0，但在图例/注记说明该处理以免误读。
- 去重与清洗：
  - brand_mentions 需对重复抓取、转发/引用去重；对垃圾信息（spam/bot）做规则过滤。
  - “品牌提及”建议采用精确匹配 + 词典扩展 + 模糊匹配的多级策略，并记录召回/精度评估。
- 品牌集合：
  - 页面所示品牌清单应固定并在数据侧保持相同集合；Others 必须基于同一集合计算。
- 多国家/多渠道：
  - 如页面限定 `countryId`，则 ETL/查询均需增加相同筛选。
  - 多渠道合并时，应先在渠道内聚合，再做全局合并，避免重复计数。
- 异常与边界：
  - total_mentions(t)=0 时，SOV 记为 0 或空值（NA），并在页面标注“无数据”。
  - 对极端值可做 winsorize（如 1%/99%）防止单点异常冲击图表尺度。

## 5. 数据源建议与示例查询
- 推荐表（依据原 README 命名）：
  - 日明细：`brand_metrics_day(brand, day, countryId, channel, mentions, engagements, sentiment)`
  - 月聚合：`brand_metrics_month(brand, month, countryId, channel, mentions, engagements, sentiment)`
- 示例（SOV 月度）：
  ```sql
  WITH monthly AS (
    SELECT month,
           brand,
           SUM(mentions) AS brand_mentions
    FROM brand_metrics_month
    WHERE countryId = :countryId
      AND month BETWEEN :m_start AND :m_end
      AND brand IN (:brands)
    GROUP BY month, brand
  ), total AS (
    SELECT month, SUM(brand_mentions) AS total_mentions
    FROM monthly
    GROUP BY month
  )
  SELECT m.month,
         m.brand,
         100.0 * m.brand_mentions / NULLIF(t.total_mentions, 0) AS sov
  FROM monthly m
  JOIN total t USING (month)
  ORDER BY m.month, m.brand;
  ```
- 示例（Lenovo vs Others 日级）：
  ```sql
  WITH daily AS (
    SELECT day,
           brand,
           SUM(mentions) AS brand_mentions
    FROM brand_metrics_day
    WHERE countryId = :countryId
      AND day BETWEEN :d_start AND :d_end
      AND brand IN (:brands)
    GROUP BY day, brand
  ), agg AS (
    SELECT day,
           SUM(CASE WHEN brand = 'Lenovo' THEN brand_mentions ELSE 0 END) AS lenovo_mentions,
           SUM(brand_mentions) AS total_mentions
    FROM daily
    GROUP BY day
  )
  SELECT day,
         lenovo_mentions,
         GREATEST(total_mentions - lenovo_mentions, 0) AS others_mentions
  FROM agg
  ORDER BY day;
  ```

## 6. 图表层面的修正建议
- 饼/环图用于展示“整体份额”，但当品牌数 >6 或份额差距不明显时，建议改为“堆叠条形图 + 排序”，提升可读性。
- 趋势图建议：
  - 双轴仅在量级差距极大时使用；否则保持单轴，避免误读。
  - 提供“平滑开关”（7D MA）与“事件标注层”（促销/发布会/节点）。
- 颜色与图例：品牌颜色固定映射；Others 使用中性色并始终置底。

## 7. 校验清单（执行层）
- 品牌集合在 SQL/ETL 与前端配置一致，Others 按同一集合计算。
- 口径：时间范围、国家/渠道筛选完全一致。
- 缺失值与 0 值处理一致且有注记。
- total_mentions=0 时无除零错误。
- 截面图与趋势图的数值能相互核对（同期间汇总一致）。

---
说明：以上为基于“品牌 SOV + Lenovo vs Others 趋势”范式的口径校准与增强建议。如与实际页面呈现不符，请在本文件中标注差异点，我会据此进一步修订。