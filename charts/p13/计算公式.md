计算公式 (Formulas)

- Data Range（数据范围）：在 `start_date` 到 `end_date`（含边界）内，按 `country_id` 与 `keyword_like` 过滤；时间字段在 `createdAtUtcMs/createdAtMs/createdAt` 中自动选择并按 UTC 取日粒度。

- Sentiment Classification（情绪判定）：
  - 若 `polarity > positive_min` → `Positive`
  - 若 `polarity < negative_max` → `Negative`
  - 其余 → `Neutral`

- Row Engagement（行级参与度）：
  - `RowEngagement = Σ(fields_candidates)`；仅对存在且可解析为数值的候选列求和。
  - 候选列来源：`config.yaml → engagement.fields_candidates`（示例：`sumLikes/sumShares/sumComments`）。

- Daily Engagement Total（日参与度总量）：
  - `EngagementTotal(day) = Σ(RowEngagement | Date=day)`。

- Sentiment Percentage（饼图占比，PieData）：
  - `sentiment_eng(lbl) = Σ(RowEngagement | Sentiment=lbl)`；`total_eng = Σ(sentiment_eng(lbl))`。
  - `Percentage(lbl) = sentiment_eng(lbl) / total_eng * 100`，保留两位小数；当 `total_eng = 0` 时写入 `0.00`。
  - 术语说明：`lbl` 表示情绪标签（`Positive/Neutral/Negative`）；`eng` 表示参与度（engagement）；`total_eng` 表示总参与度（各情绪参与度之和，LineData 场景下指当日总参与度）。

- Line Index（日情绪指数，LineData；IndexGlobal）：
  - 定义：对所有天与三类情绪的参与度取全局最大值 `M = max_{d,l}(eng(l,d))`；
  - 公式：`Index(lbl, day) = 100 * eng(lbl, day) / M`；若 `M = 0` 则指数统一记为 `0.00`；
  - 说明：这是“趋势指数”，不再要求同一天三条线相加为 100；最大峰值约为 100，便于直观比较不同日期的相对强度。

- Rounding（数值保留）：所有百分比与指数统一 `round(…, 2)`，保留两位小数。

业务含义 (Business Semantics)

- Sentiment（情绪标签）：基于 `polarity` 阈值将每条内容判为 `Positive/Neutral/Negative`，代表用户态度方向（正/中/负），不表示强烈程度。
- Engagement（参与度）：用互动行为的加总（如 `sumLikes/sumShares/sumComments`）衡量内容被关注与互动的强度，比“帖子数量”更能反映影响力。
- PieData（饼图业务含义）：展示所选时间范围内各情绪占总体参与度的比例，回答“整体互动中哪种情绪占比更高？”。用于判断品牌互动更偏向正面、中性还是负面。
- LineData（折线业务含义）：展示每日各情绪在当日总参与度中的百分比分布，回答“情绪结构每天如何变化？”。每天三类相加为 100%，用于监控事件或内容引发的情绪结构变化。
- Audit（审计表用途）：`AuditRow/AuditDay/AuditMonth` 逐层展示“原始列 → 行级参与度 → 聚合参与度 → 百分比”，`PostId/Channel` 仅为溯源展示，不参与计算。
- Zero Total（分母为 0）：当总体或当日参与度为 0 时写入 `0.00%`，表示无互动；如需改为报错，可在脚本中改为抛异常并同步文档。
- Filters & Time（过滤与时间）：按国家与关键词过滤，采用 UTC 按日聚合，确保 Excel 与图表口径一致（饼图为总体、折线图为当日）。
- Not Exposure（非曝光口径）：不使用 `impressions`/IPM，所有百分比均基于参与度，避免以浏览量作为权重导致误读。